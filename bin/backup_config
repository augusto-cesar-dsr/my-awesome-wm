#!/bin/bash

# AwesomeWM Configuration Backup Script
# Cria backup completo da configura√ß√£o do AwesomeWM

CONFIG_DIR="$HOME/.config/awesome"
BACKUP_DIR="$HOME/.config/awesome_backups"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
BACKUP_NAME="awesome_backup_$TIMESTAMP"

# Criar diret√≥rio de backup se n√£o existir
mkdir -p "$BACKUP_DIR"

# Fun√ß√£o para mostrar progresso
show_progress() {
    echo "üîÑ $1"
}

# Fun√ß√£o para mostrar sucesso
show_success() {
    echo "‚úÖ $1"
}

# Fun√ß√£o para mostrar erro
show_error() {
    echo "‚ùå $1"
}

show_progress "Iniciando backup da configura√ß√£o AwesomeWM..."

# Verificar se o diret√≥rio de configura√ß√£o existe
if [ ! -d "$CONFIG_DIR" ]; then
    show_error "Diret√≥rio de configura√ß√£o n√£o encontrado: $CONFIG_DIR"
    exit 1
fi

# Criar backup
show_progress "Criando backup em: $BACKUP_DIR/$BACKUP_NAME"

if cp -r "$CONFIG_DIR" "$BACKUP_DIR/$BACKUP_NAME"; then
    show_success "Backup criado com sucesso!"
    
    # Mostrar informa√ß√µes do backup
    echo ""
    echo "üìÅ Backup salvo em: $BACKUP_DIR/$BACKUP_NAME"
    echo "üìä Tamanho do backup: $(du -sh "$BACKUP_DIR/$BACKUP_NAME" | cut -f1)"
    echo "üïí Data/Hora: $(date)"
    echo "üë§ Usu√°rio: $USER"
    
    # Listar arquivos principais no backup
    echo ""
    echo "üìã Arquivos principais inclu√≠dos:"
    find "$BACKUP_DIR/$BACKUP_NAME" -name "*.lua" -o -name "*.md" | head -10 | sed 's|.*/||' | sort | sed 's/^/   ‚Ä¢ /'
    
    # Limpar backups antigos (manter apenas os 5 mais recentes)
    show_progress "Limpando backups antigos..."
    cd "$BACKUP_DIR" || exit 1
    ls -t | grep "awesome_backup_" | tail -n +6 | xargs -r rm -rf
    
    # Mostrar backups dispon√≠veis
    echo ""
    echo "üíæ Backups dispon√≠veis:"
    ls -t "$BACKUP_DIR" | grep "awesome_backup_" | head -5 | sed 's/^/   ‚Ä¢ /'
    
else
    show_error "Falha ao criar backup!"
    exit 1
fi

echo ""
show_success "Backup conclu√≠do com sucesso! üéâ"
